
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <script>
    const wrapper = '#pwa-notification';
    const button = '#sw-reload'
    var newWorker;
    // The click event on the notification
    document.querySelector('#sw-reload').addEventListener('click', function (e) {
        e.preventDefault()
        newWorker.postMessage({ action: 'skipWaiting' });
    });

    if ('serviceWorker' in window.navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js')
                .then(reg => {
                    console.warn('[SW] üòÄ registered! in scope', reg.scope, reg)
                    reg.addEventListener('updatefound', () => {
                        // An updated service worker has appeared in reg.installing!
                        newWorker = reg.installing;
                        newWorker.addEventListener('statechange', () => {
                            console.warn('[SW] , STATECHANGE => ', newWorker.state)
                            // Has service worker state changed?
                            switch (newWorker.state) {
                                case 'installed':
                                    // There is a new service worker available, show the notification
                                    if (navigator.serviceWorker.controller) {
                                        const notification = document.querySelector(wrapper);
                                        notification.style.display = 'block';
                                    }
                                    break;
                            }
                        });
                    });

                })
                .catch(err => console.warn('[SW] ü•∫ register error =>', err))
        })
    }

    let refreshing;
    // The event listener that is fired when the service worker updates
    // Here we reload the page
    navigator.serviceWorker.addEventListener('controllerchange', function () {
        if (refreshing) return;
        window.location.reload();
        refreshing = true;
    });

    </script>

        <div style="display:none" id="pwa-notification">
            –î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            <a href="" id="sw-reload">–æ–±–Ω–æ–≤–∏—Ç—å</a>
            <span class="closebtn" onclick="this.parentElement.style.display='none';">√ó</span>
        </div>

        <style>
            #pwa-notification {
                position: fixed;
                right: 0;
                bottom: 0;
                padding: 13px 20px;
                color: #fff;
                background-color: #141518;
            }
        
            #sw-reload {
                color: #9fc0f7;
            }
        
            .closebtn {
                margin-left: 15px;
                color: white;
                font-weight: bold;
                float: right;
                font-size: 22px;
                line-height: 20px;
                cursor: pointer;
                transition: 0.3s;
            }
        
            .closebtn:hover {
                color: black;
            }
        </style>
</body>
</html>